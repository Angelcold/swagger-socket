<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <script type="text/javascript" src="jquery/jquery-1.6.4.js"></script>
    <script type="text/javascript" src="jquery/jquery.form.js"></script>
    <script type="text/javascript" src="jquery/jquery.list.js"></script>
    <script type="text/javascript" src="jquery/jquery.swaggersocket.js"></script>
    <script type="text/javascript" src="js/raphael-min.js"></script>
    <script type="text/javascript" src="js/dracula_graffle.js"></script>
    
    <script type="text/javascript" src="js/dracula_graph.js"></script>
    <script type="text/javascript" src="js/nodes.js"></script>
    <script type="text/javascript">
$(document).ready(function() {
    var ss = new jQuery.swaggersocket.SwaggerSocketListener();
    var swaggerSocket = new jQuery.swaggersocket.SwaggerSocket();
    var incompleteMessage = "";

    ss.onError = function(errorMsg, r) {
        $('#result').prepend($('<li>').append(errorMsg + ":" + r.getStatus() + " " + r.getReasonPhrase()));
    };

    ss.onResponse = function(r) {
        $('#result li').each(function(index) {
            $(this).remove();
        });

        $('#definitions li').each(function(index) {
            $(this).remove();
        });

        try {
            var swaggerResponse = $.parseJSON(incompleteMessage + r.getData());
            incompleteMessage = "";
			var inputWord = getElementById('phrase').value;
            if (swaggerResponse != null) {
//    			bang();
                swaggerResponse.forEach(function(node) {
                    try {
                    	if(inputWord.length > 3)
                    		addEdge(inputWord, node.word);
                    } catch (e) {
                    }
                });
                redraw();
            }
        } catch (err) {
            incompleteMessage = r.getData();
        }
    };
    var incompleteMessage = "";

    open();

    function getKeyCode(ev) {
        if (window.event) return window.event.keyCode;
        return ev.keyCode;
    }

    function getElementById() {
        return document.getElementById(arguments[0]);
    }

    function getElementByIdValue() {
        return document.getElementById(arguments[0]).value;
    }

    function open() {
        var request = new jQuery.swaggersocket.Request()
                .path('/')
                .listener(ss);

        swaggerSocket.open(request);
    }

    getElementById('phrase').setAttribute('autocomplete', 'OFF');
    getElementById('phrase').onkeyup = function(event) {

        if (getElementById('phrase').value == '') {
            $('#result li').each(function(index) {
                $(this).remove();
            });
            return;
        }

        var request = new jQuery.swaggersocket.Request()
           .path("/api/graph.json/" + getElementById('phrase').value)
           .method("GET")
           .listener(ss);

        swaggerSocket.send(request);
        return false;
    };

    getElementById('phrase').onclick = function(event) {
        if (getElementById('phrase').value == 'Look up any word or phrase...') {
            getElementById('phrase').value = '';
        }
    }
    
	setup();
});
    </script>
    <style type='text/css'>
        body {
            text-align: center;
        }

        div {
            border: 0px solid black;

        }

        .highlight {
            background-color: yellow
        }

        input#phrase {
            width: 20em;
            height: 3em;
            font-size: 100%;
            background-color: #e0f0f0;
        }

        ul {
            list-style-type: none;
            text-align: left;
        }

    </style>
</head>
<body>
<h1></h1>
<html>
<body>
<div id="canvas"></div>
<button id="cl" onclick="bang();">clear</button>
</body>
</html>

<br/><br/><br/><br/>
<br/>

<div id='sendMessage'>
    <input id='phrase' type='text' value="Look up any word or phrase..."/>
    <br>
</div>
<br/>

<ul id='definitions'></ul>
<ul id="result"></ul>
</body>
</html>
